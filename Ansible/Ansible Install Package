Task:
Create an inventory file /home/thor/playbook/inventory on jump host and add all app servers in it.


Create an Ansible playbook /home/thor/playbook/playbook.yml to install samba package on all  app servers using Ansible yum module.


Make sure user thor should be able to run the playbook on jump host.

Note: Validation will try to run playbook using command ansible-playbook -i inventory playbook.yml so please make sure playbook works this way, without passing any extra arguments.


###########
sol: 
1. mkdir -p /home/thor/playbook

2. Create /home/thor/playbook/inventory with the following content:
stapp01 ansible_host=172.16.238.10 ansible_user=tony ansible_ssh_pass=Ir0nM@n
stapp02 ansible_host=172.16.238.11 ansible_user=steve ansible_ssh_pass=Am3ric@
stapp03 ansible_host=172.16.238.12 ansible_user=banner ansible_ssh_pass=BigGr33n

if you get this error:fatal: [stapp02]: FAILED! => {"changed": false, "module_stderr": "Shared connection to 172.16.238.11 closed.\r\n", "module_stdout": "", "msg": "MODULE FAILURE\nSee stdout/stderr for the exact error", "rc": 137}

use this: sol for rc: 137 with “Shared connection closed”
[app_servers]
stapp01 ansible_host=172.16.238.10 ansible_user=tony ansible_ssh_pass=Ir0nM@n ansible_become_pass=Ir0nM@n
stapp02 ansible_host=172.16.238.11 ansible_user=steve ansible_ssh_pass=Am3ric@ ansible_become_pass=Am3ric@
stapp03 ansible_host=172.16.238.12 ansible_user=banner ansible_ssh_pass=BigGr33n ansible_become_pass=BigGr33n

Passwordless or ssh keys:
ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N "" ----> This creates:

~/.ssh/id_rsa (private key)
~/.ssh/id_rsa.pub (public key)


ssh-copy-id tony@172.16.238.10
ssh-copy-id steve@172.16.238.11
ssh-copy-id banner@172.16.238.12

Inventory file: 
[app_servers]
stapp01 ansible_host=172.16.238.10 ansible_user=tony
stapp02 ansible_host=172.16.238.11 ansible_user=steve
stapp03 ansible_host=172.16.238.12 ansible_user=banner

If sudo still asks for a password, you can either:
Configure passwordless sudo on the app servers, or
Add --ask-become-pass when running the playbook

Configure passwordless sudo on the app servers:
On each server:
sudo visudo -f /etc/sudoers.d/tony
Add:
tony ALL=(ALL) NOPASSWD: ALL





3. Create /home/thor/playbook/playbook.yml:
---
- name: Install Samba on all app servers
  hosts: app_servers
  become: yes
  tasks:
    - name: Install samba package
      yum:
        name: samba
        state: present


4.Set correct ownership and permissions on the jump host:
chown -R thor:thor /home/thor/playbook
chmod 755 /home/thor
chmod 755 /home/thor/playbook
chmod 644 /home/thor/playbook/inventory
chmod 644 /home/thor/playbook/playbook.yml

5. RUN
cd /home/thor/playbook
ansible-playbook -i inventory playbook.yml


#####################
Since the ZIP file exists only on the jump host (/usr/src/devops/xfusion.zip), the playbook must:

Copy the ZIP file to each app server

Unzip it into /opt/devops/ on each app server

Set ownership based on the server

Ensure extracted files have permission 0744

Create /home/thor/ansible/playbook.yml with this content:

---
- name: Unzip xfusion archive on all app servers
  hosts: all
  become: yes
  tasks:

    - name: Ensure destination directory exists
      file:
        path: /opt/devops
        state: directory
        mode: '0755'

    - name: Copy xfusion.zip to app servers
      copy:
        src: /usr/src/devops/xfusion.zip
        dest: /tmp/xfusion.zip
        mode: '0644'

    - name: Unzip archive on App Server 1
      unarchive:
        src: /tmp/xfusion.zip
        dest: /opt/devops
        remote_src: yes
        owner: tony
        group: tony
        mode: '0744'
      when: inventory_hostname == "stapp01"

    - name: Unzip archive on App Server 2
      unarchive:
        src: /tmp/xfusion.zip
        dest: /opt/devops
        remote_src: yes
        owner: steve
        group: steve
        mode: '0744'
      when: inventory_hostname == "stapp02"

    - name: Unzip archive on App Server 3
      unarchive:
        src: /tmp/xfusion.zip
        dest: /opt/devops
        remote_src: yes
        owner: banner
        group: banner
        mode: '0744'
      when: inventory_hostname == "stapp03"


