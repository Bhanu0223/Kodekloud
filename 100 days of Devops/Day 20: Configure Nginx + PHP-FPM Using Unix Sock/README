############################################################
The Nautilus application development team is planning to launch a new PHP-based application, which they want to deploy on Nautilus infra in Stratos DC. The development team had a meeting with the production support team and they have shared some requirements regarding the infrastructure. Below are the requirements they shared:


a. Install nginx on app server 1 , configure it to use port 8099 and its document root should be /var/www/html.


b. Install php-fpm version 8.3 on app server 1, it must use the unix socket /var/run/php-fpm/default.sock (create the parent directories if don't exist).


c. Configure php-fpm and nginx to work together.


d. Once configured correctly, you can test the website using curl http://stapp01:8099/index.php command from jump host.

NOTE: We have copied two files, index.php and info.php, under /var/www/html as part of the PHP-based application setup. Please do not modify these files.
############################################################
Do all steps on App Server 1 (stapp01).

1Ô∏è‚É£ Install Nginx and configure it on port 8099
sudo yum install -y nginx


Edit the main Nginx config:

sudo vi /etc/nginx/nginx.conf


Inside the http { ... } block, add/modify a server block like this:

server {
    listen 8099;
    server_name stapp01;
    root /var/www/html;
    index index.php index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    location ~ \.php$ {
        include fastcgi_params;
        fastcgi_pass unix:/var/run/php-fpm/default.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}

2Ô∏è‚É£ Install PHP-FPM 8.3

Enable PHP 8.3 module (on RHEL/CentOS-based systems):

sudo yum install -y epel-release
sudo yum install -y https://rpms.remirepo.net/enterprise/remi-release-8.rpm
sudo yum module reset php -y
sudo yum module enable php:remi-8.3 -y
sudo yum install -y php php-fpm


Create the socket directory:

sudo mkdir -p /var/run/php-fpm


Edit PHP-FPM pool config:

sudo vi /etc/php-fpm.d/www.conf


Update these lines:

user = nginx
group = nginx

listen = /var/run/php-fpm/default.sock
listen.owner = nginx
listen.group = nginx
listen.mode = 0660

3Ô∏è‚É£ Start and enable services
sudo systemctl start php-fpm
sudo systemctl enable php-fpm

sudo systemctl start nginx
sudo systemctl enable nginx


Test Nginx configuration:

sudo nginx -t

4Ô∏è‚É£ Verify from Jump Host

From jump host:

curl http://stapp01:8099/index.php


You should see the output generated by index.php.

You can also test:

curl http://stapp01:8099/info.php


If both work, then:

Nginx is running on port 8099

PHP-FPM 8.3 is using the socket
/var/run/php-fpm/default.sock

Nginx and PHP-FPM are correctly integrated

The PHP application is ready üöÄ

ChatGPT can make mistakes. Check important info. See Cookie Preferences.
