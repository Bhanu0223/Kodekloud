######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### 
Question: We have one of our websites up and running on our Nautilus infrastructure in Stratos DC.
Our security team has raised a concern that right now Apache’s port i.e 6300 is open for all since there is no firewall installed on these hosts.
So we have decided to add some security layer for these hosts and after discussions and recommendations we have come up with the following requirements:


1. Install iptables and all its dependencies on each app host.


2. Block incoming port 6300 on all apps for everyone except for LBR host.


3. Make sure the rules remain, even after system reboot.

######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### 

Solution: 

Creating the Ansible playbook and ini file  enable only LBR and block remaining incoming conncetions:

inventory.ini and secure_apache_iptables.yml. 

Create a working directory (recommended)
mkdir -p ~/iptables-security
cd ~/iptables-securit

ansible-playbook -i inventory.ini secure_apache_iptables.yml

iptables installed on all app servers
✔ Port 5004 allowed only from 172.16.238.14
✔ All other access to port 5004 blocked
✔ Rules persist after reboot
######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### ######### 



Manual:

Add Iptables:

iptables -I INPUT -p tcp -s 172.16.238.14 --dport 6300 -j ACCEPT
iptables -A INPUT -p tcp --dport 6300 -j DROP

To See:
sudo iptables-save | sudo tee /etc/sysconfig/iptables
or 
sudo iptables -L INPUT -n -v --line-numbers

to check connection:
nc -zv 172.16.238.12 3003

This command uses netcat (nc) to test whether a TCP port is open on a remote host.

nc → Netcat utility (network tester)

-z → “Zero I/O” mode

Don’t send data; just check if the port is open

-v → Verbose output (shows clear success/failure message)

172.16.238.12 → Target host (your server)

3003 → Target port






